<!DOCTYPE html> <html lang="es"> <head> <meta charset="UTF-8" /> <title>Asteroids Retro</title> <!-- Fuentes retro de estilo arcade --> <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" /> <style> /* Fondo: degradado radial (rojo, blanco y azul, evocador de la bandera francesa) */ body { margin: 0; overflow: hidden; background: radial-gradient(circle, red, white, blue); font-family: "Press Start 2P", cursive; } canvas { display: block; } /* Pantalla de inicio y Game Over, centradas en el viewport */ #startScreen, #gameOverScreen { position: absolute; top: 0; left: 0; z-index: 10; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); color: #fff; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; } #startScreen h1, #gameOverScreen h1 { margin-bottom: 20px; font-size: 40px; } #instructions p { margin: 5px 0; font-size: 14px; } button { font-family: "Press Start 2P", cursive; font-size: 20px; padding: 10px 20px; background: #222; border: 2px solid #fff; color: #fff; cursor: pointer; margin-top: 20px; } button:hover { background: #444; } /* HUD: marcador, temporizador y vidas */ #scoreboard { position: absolute; top: 10px; right: 20px; color: #fff; font-size: 20px; z-index: 5; } #timer { position: absolute; top: 10px; left: 20px; color: #fff; font-size: 20px; z-index: 5; } #lives { position: absolute; bottom: 10px; right: 20px; z-index: 5; } </style> </head> <body> <!-- Pantalla de inicio: botón para forzar el primer clic y mostrar las instrucciones --> <div id="startScreen"> <h1>Asteroids Retro</h1> <button id="startButton">Iniciar Juego</button> <div id="instructions"> <p>Flecha Izquierda: Girar izquierda</p> <p>Flecha Derecha: Girar derecha</p> <p>Flecha Arriba: Avanzar</p> <p>Flecha Abajo: Retroceder</p> <p>Espacio: Disparar</p> </div> </div>
<!-- Lienzo del juego -->
<canvas id="gameCanvas" style="display:none;"></canvas>

<!-- Pantalla de Game Over -->
<div id="gameOverScreen" style="display:none;">
  <h1>Game Over</h1>
  <p id="finalScore"></p>
  <button id="restartButton">Reiniciar</button>
</div>

<!-- HUD: marcador, temporizador y vidas -->
<div id="scoreboard" style="display:none;">Score: 0</div>
<div id="timer" style="display:none;">Tiempo: 60</div>
<div id="lives" style="display:none;"></div>

<script>
  /* ────────────────────────────────────────────── 
     Pre-carga de recursos gráficos y de audio
  ────────────────────────────────────────────── */
  const shipImg = new Image();
  shipImg.src = "pepe.png"; // Imagen de la nave

  const asteroidImg = new Image();
  asteroidImg.src = "uk.jpg"; // Imagen de los asteroides

  const projectileImg = new Image();
  projectileImg.src = "croissant.png"; // Se usará tanto para proyectiles como para representar las vidas

  const bgMusic = new Audio("musica.mp3");
  bgMusic.loop = true;
  const hitSound = new Audio("tos.mp3");

  /* ────────────────────────────────────────────── 
     Configuración del Canvas
  ────────────────────────────────────────────── */
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  /* ────────────────────────────────────────────── 
     Variables globales de juego
  ────────────────────────────────────────────── */
  let gameStarted = false;
  let gameOver = false;
  let lives = 3;
  let score = 0;
  let timeLeft = 60; // segundos
  let lastTime = 0;
  const keys = {};

  // Propiedades de la nave (ahora 50% más grande: radio 30 en lugar de 20)
  const ship = {
    x: canvas.width / 2,
    y: canvas.height / 2,
    angle: 0,
    velocity: { x: 0, y: 0 },
    radius: 30,
    rotationSpeed: 0.07,
    acceleration: 0.2,
    friction: 0.99,
  };

  const projectiles = [];
  const asteroids = [];

  /* ────────────────────────────────────────────── 
     Función para crear asteroides (ahora mayor cantidad)
  ────────────────────────────────────────────── */
  function createAsteroid() {
    return {
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      vx: (Math.random() - 0.5) * 2,
      vy: (Math.random() - 0.5) * 2,
      radius: 30 + Math.random() * 20,
    };
  }

  function initAsteroids() {
    asteroids.length = 0;
    // Por ejemplo, 15 asteroides en pantalla
    for (let i = 0; i < 15; i++) {
      asteroids.push(createAsteroid());
    }
  }

  /* ────────────────────────────────────────────── 
     Eventos del teclado
  ────────────────────────────────────────────── */
  window.addEventListener("keydown", (e) => {
    keys[e.key] = true;
    // Si ya se ha iniciado el juego, iniciamos la música de fondo (respetando las restricciones de autoplay)
    if (gameStarted && bgMusic.paused) {
      bgMusic.play().catch(() => {});
    }
  });
  window.addEventListener("keyup", (e) => {
    keys[e.key] = false;
    if (e.key === " ") {
      keys.spaceFired = false;
    }
  });

  /* ────────────────────────────────────────────── 
     Botón de inicio y reinicio
  ────────────────────────────────────────────── */
  const startButton = document.getElementById("startButton");
  startButton.addEventListener("click", startGame);

  const restartButton = document.getElementById("restartButton");
  restartButton.addEventListener("click", () => {
    window.location.reload();
  });

  function startGame() {
    gameStarted = true;
    gameOver = false;
    // Ocultar inicio y mostrar canvas y HUD
    document.getElementById("startScreen").style.display = "none";
    canvas.style.display = "block";
    document.getElementById("scoreboard").style.display = "block";
    document.getElementById("timer").style.display = "block";
    document.getElementById("lives").style.display = "block";

    // Reiniciar variables
    lives = 3;
    score = 0;
    timeLeft = 60;
    ship.x = canvas.width / 2;
    ship.y = canvas.height / 2;
    ship.angle = 0;
    ship.velocity = { x: 0, y: 0 };

    initAsteroids();

    // Iniciamos el game loop
    lastTime = 0;
    requestAnimationFrame(gameLoop);
  }

  /* ────────────────────────────────────────────── 
     Game Loop con control de delta time
  ────────────────────────────────────────────── */
  function gameLoop(timestamp) {
    if (!lastTime) lastTime = timestamp;
    let delta = (timestamp - lastTime) / 1000;
    lastTime = timestamp;

    if (!gameOver) {
      update(delta);
      render();
      requestAnimationFrame(gameLoop);
    } else {
      showGameOver();
    }
  }

  /* ────────────────────────────────────────────── 
     Actualización de la lógica del juego
  ────────────────────────────────────────────── */
  function update(delta) {
    // Actualizamos el temporizador
    timeLeft -= delta;
    if (timeLeft <= 0) {
      timeLeft = 0;
      gameOver = true;
    }

    // Controles de la nave
    if (keys["ArrowLeft"]) {
      ship.angle -= ship.rotationSpeed;
    }
    if (keys["ArrowRight"]) {
      ship.angle += ship.rotationSpeed;
    }
    if (keys["ArrowUp"]) {
      ship.velocity.x += Math.cos(ship.angle) * ship.acceleration;
      ship.velocity.y += Math.sin(ship.angle) * ship.acceleration;
    }
    if (keys["ArrowDown"]) {
      ship.velocity.x -=
        Math.cos(ship.angle) * ship.acceleration * 0.5;
      ship.velocity.y -=
        Math.sin(ship.angle) * ship.acceleration * 0.5;
    }

    ship.x += ship.velocity.x;
    ship.y += ship.velocity.y;
    ship.velocity.x *= ship.friction;
    ship.velocity.y *= ship.friction;

    // Envolver la nave en la pantalla
    if (ship.x < 0) ship.x = canvas.width;
    if (ship.x > canvas.width) ship.x = 0;
    if (ship.y < 0) ship.y = canvas.height;
    if (ship.y > canvas.height) ship.y = 0;

    // Disparar: al pulsar espacio se generan proyectiles.
    // Ahora, los proyectiles serán más grandes, de aproximadamente la mitad del tamaño de la nave.
    if (keys
